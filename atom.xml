<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan CSS ABRS  Support Blog !!</title>
  
  <subtitle>Azure Backup , Azure Site Recovery , Azure Migrate に関するサポート情報を発信します。</subtitle>
  <link href="https://jpabrs-scem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpabrs-scem.github.io/blog/"/>
  <updated>2022-10-26T05:44:11.738Z</updated>
  <id>https://jpabrs-scem.github.io/blog/</id>
  
  <author>
    <name>Japan CSS ABRS &amp; SCEM Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>私、ヨガインストラクターのたつみ。</title>
    <link href="https://jpabrs-scem.github.io/blog/information/example2/"/>
    <id>https://jpabrs-scem.github.io/blog/information/example2/</id>
    <published>2023-01-02T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.738Z</updated>
    
    <content type="html"><![CDATA[<p>記事概要</p><span id="more"></span><p>今日は最近手に入れたカモミールティーを飲みながら、私の過去の体験談について話すわ。</p><p>「悪の十字架」</p><p>暑い暑い夏の夜。<br>そう、今晩のような夜だったそうです。<br>私は、その日、眠れませんでした。<br>のどがからっからに乾いていたんです。<br>冷蔵庫の中は昨日から何も入っていません。<br>しかたなく私は台所に行って、水道の蛇口をひねりました。<br>ところが、・・・<br>水が出ないのです。<br>断水？？？いや、そんなことは聞いていない。<br>でも、やはり水は出ないのです。<br>異常なのどの渇き。<br>私はがまんできなくなり、近くのスーパーに水を買いに行きました。<br>しかし、時計は夜中の１時。こんな時間までスーパーは開いているのか、少し不安でした。そのころは、今のようなコンビニなどありませんでした。<br>人気（ひとけ）のない道を私は急ぎました。<br>ついにスーパーに着きました。しかし、案の定、そのシャッターは下りていたのです。<br>横になる扉を何度もたたいてみましたが、 何の反応はありません。<br>そのとき、私は気づきました。ドアの横に貼ってある紙に。<br>紙には消えそうな文字で明日の開店時間が書いてありました。<br>私はつぶやいた。<br>「このスーパー、明日開くの十時か・・・」<br>「開くの十時か・・・」<br>「開くの十時か・・・」<br>「悪の十字架！！」</p><h2 id="見出し-大"><a href="#見出し-大" class="headerlink" title="見出し (大)"></a>見出し (大)</h2><h3 id="見出し-中"><a href="#見出し-中" class="headerlink" title="見出し (中)"></a>見出し (中)</h3><h4 id="見出し-小"><a href="#見出し-小" class="headerlink" title="見出し (小)"></a>見出し (小)</h4>]]></content>
    
    
    <summary type="html">&lt;p&gt;記事概要&lt;/p&gt;</summary>
    
    
    
    
    <category term="Information" scheme="https://jpabrs-scem.github.io/blog/tags/Information/"/>
    
    <category term="Example" scheme="https://jpabrs-scem.github.io/blog/tags/Example/"/>
    
  </entry>
  
  <entry>
    <title>私、バリキャリOLのたかと。</title>
    <link href="https://jpabrs-scem.github.io/blog/information/example/"/>
    <id>https://jpabrs-scem.github.io/blog/information/example/</id>
    <published>2023-01-01T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.738Z</updated>
    
    <content type="html"><![CDATA[<p>記事概要</p><span id="more"></span><p>未来について今日は語ろうとおもうわ。</p><p>ハドソン夫人――彼女はシャーロック・ホームズの家主であるが、辛抱強い女性である。二階の部屋には四六時中、おかしな、しかも大抵は歓迎できない連中が上がり込むばかりでなく、その居住者ときたら生活が突飛で不規則で、これにはさすがの彼女もあきれ顔だったろう。ホームズは信じられないほどだらしないし、とんでもない時間に楽器をかき鳴らす。室内での気まぐれな射撃訓練、時々異臭さえする妙な化学実験。それに加えて身辺には血と危険の匂いがするというのだから、ロンドン一最低の下宿人だ。だが一方で払いが良かった。私と同居していた時期の家賃をまとめれば、軽くあの家を買い取れたに相違ない。<br>　家主はホームズに畏敬の念を抱いており、なす事がいかに常識に反していても、一言も口を挟もうとしなかった。それに彼女はホームズのことが好きだった。女性に対して非常に優しく、礼節を持って接したからだ。ホームズは一般に言う「女」を嫌い、信用しなかったが、それは常に対等な相手と見て、騎士たらんとしたからだ。彼女のホームズを慕う心は本物であると知っていたので、私の元を訪れてまで話す彼女の言葉に、私は耳を傾けたのであった。それは私が結婚して二年経った頃のことで、我が友人が今や哀れ、見るに堪えない状態に陥っているという話だった。<br>「今にも死にそうですの、ワトソンさま。」とハドソン夫人は言った。「この三日というもの、やつれる一方で、今日一日生きられますかどうか。それなのに医者は呼ぶなと。今朝などは頬がこけて、目をぎょろつかせるものですから、居ても立ってもいられなくなって。『お許しがあろうとなかろうと、ホームズさま、この足でお医者さまを呼びに参ります。』とわたくしは申し上げました。すると『ならばワトソンを。』とおっしゃいまして。片時も目を離したくはありません。死に目にお会いになれないかも。」<br>　驚いた。今まで病気など一度もなかった彼のことだ。何も言わず外套と帽子をひっかけ、私は車中、事情を教えてくれと頼んだ。<br>「お話しできることがほとんどなくて。ちょうどロザハイズに出向して事件をお手がけで、河近くの並木道です。そこからこの病気をお持ち帰りに。水曜の午後から床にお就きになったまま、寝たきりなんです。この三日間は、喉に何もお通しになさらず。」<br>「そんな！　どうして今まで医者を？」<br>「お止めになるのです。あの方、強情でしょう？　ですから押し切れなくて。でも、もう永くはございません。わかります、ご覧になれば、すぐ。」<br>　確かに本人は、見るも無惨な有様だった。霧深い十一月の日の薄明かりだ、病室は陰気な所となり、さらに寝台から私へ向けられた憔悴の顔が、私の肝を冷やす。熱のために目に力が入りすぎ、両頬には消耗性紅潮が見られ、唇は変色した瘡蓋かさぶたが。布団の上で、手は絶えず痙攣し、声も枯れて途切れ途切れだ。私が入室したとき、ぴくりともしなかったが、姿を見るや目が反応したので、気づいてはいるらしい。<br>「どうも、ワトソン、ふたり揃って災難だね。」声は力無いが、いつも通りの気の置けない口ぶりだった。<br>「まったく君は！」と私は近づきながら叫ぶ。<br>「来るな！　下がれ！」緊迫感のあるその鋭い声が、私の心に「危篤」の二文字を思い起こさせる。「近寄るなら、ワトソン、君にここから出ていってもらう。」<br>「なぜだね？」<br>「僕が嫌なんだ、それでいいだろう？」<br>　なるほど、ハドソン夫人の言う通りだった。いつも以上に強情だ。とはいえ、その窶やつれたさまは見るも気の毒だ。<br>「助けたいだけなんだ。」と私は言う。<br>「その通り！　僕の言う通りにしてくれると何よりも助かる。」<br>「わかった、ホームズ。」<br>　するとホームズも気を緩める。<br>「気を悪くしないでくれ。」と息も切れ切れに言った。<br>　気の毒に、こんな有様で伏せる相手に、どうして怒ったりできよう。<br>「君自身のためだ、ワトソン。」と声をしぼる。<br>「私のため？」<br>「自分の身に起こった事態は把握している。スマトラのクーリー病だ――オランダ人の方が詳しいだろうが、それでもいまだに不明なことが多い。だがこれだけは確かだ。致死率が極めて高く、人に伝染しやすい。」<br>　ホームズはまさに熱にうなされつつも、言葉を吐き、長い手をふるわせながら私に下がれと合図をする。<br>「接触感染するんだ、ワトソン――接触なんだ、近寄らなければ心配ない。」<br>「まったく、ホームズ！　私がそんなことを気にするとでも、本気で思ってるのかね！　見ず知らずの人でも何ともない。そんなことで、古なじみの義務を放棄するわけないではないか。」<br>　前へ踏み出そうとすると、鬼の形相ではねつける。<br>「じっとするなら話をする。できなければ部屋を出てくれ。」<br>　ホームズは世間の人々とは違う。その点はたぶんに尊重してきたので、意味が分からなくても、今まで彼の思うところには従ってきた。だが今回ばかりは医者としての使命がある。他の場所ならどこでも私は付き従うが、少なくとも病室では私の言うことを聞いてもらう。<br>「ホームズ。」と私は言った。「いつもとは違う。病人は子どもに過ぎない。だから診察する。好もうと好まざるとも、症状を診て君に手当を施す。」<br>　ホームズは私のことを敵意むき出しで見つめる。<br>「どうしても医者にかからねばならぬのなら、せめて頼るになる奴にかからせてくれ。」と言うのだ。<br>「では、私では不足と？」<br>「友情については頼りにしてる。だが事実は事実だ、ワトソン、つまるところ、君はごく限られた経験と並の免状しかない普通の開業医に過ぎない。あまり言いたくはないが、どうしてもと言うならやむを得ない。」<br>　私はひどく傷ついた。<br>「君らしくもない言葉だ、ホームズ。今ので君の神経の状態がはっきりした。だが、頼りないと言われたものを押しつけるつもりもない。ジャスパ・ミーク勲士かペンローズ・フィッシャなり、このロンドンにいる適当な人物を連れてこよう。いいかい、誰かしらには診てもらう、これは決まりだ。私がここに突っ立ったまま、自分で診ることも誰かを連れてきて診てもらうこともなく、見殺しに出来ると思ったら、とんだ見込み違いだ。」<br>「善意だとは思うが、ワトソン。」病人はむせびともわめきともつかない声を立てる。「君が無知と立証しようか？　知っているのかね、ほら、タパヌリ熱を？　黒色台湾熱が分かると言うのかね？」<br>「どちらも初耳だ。」<br>「病気という問題が多数、奇病がいくつも潜んでいるのだ、東洋には。ワトソン。」一文一文を息を継いでは言う。「犯罪医学方面の調べものをしているうち、知識がついた。そのさなかに、この病にかかったのだ。君には手に負えない。」<br>「かもしれん。だが、ちょうどアインストリ博士がロンドンにご滞在だそうだ。今の熱帯病の第一人者だよ。もう抗議は受け付けない。ホームズ、今すぐにでも連れてくる。」と私は決心して扉の方を向く。<br>　このときほど肝を抜かれたことはない。刹那、虎のように飛び抜けて、この瀕死の病人が行く手を遮ったのだ。カチャリと鍵をかけ、次の瞬間には、よろよろと寝台に引き返し、ない力を無理に振り絞ったため、あえぎながらぐったりとする。<br>挿絵１<br>「まさか力づくで鍵を取りはしないね、ワトソン。こっちのものだ。出られぬよ、僕がいいと言うまで外に出さない。だが話は聞くつもりだ。」（と一気に言葉を吐いた。合間にはひどく苦しそうに息をする。）「君は心から僕の親身になっている。もちろん承知している。呼んできてもいいが、体力が戻るまで余裕をくれ。今は待て、ワトソン、今は駄目だ。四時か。六時には出てもいい。」<br>「正気を失ってるね、ホームズ。」<br>「ほんの二時間だ、ワトソン。六時に出る、約束しよう。おとなしく待ってくれるか。」<br>「どう答えても一緒だろう？」<br>「その通りだ、ワトソン。ありがとう、布団は自分で何とかする。そこから近寄らないでくれ。ところでワトソン、もうひとつ希望の条件がある。呼ぶなら、先ほど挙げた人物ではなく、僕の選んだ人にしてほしい。」<br>「承知した。」<br>「君が部屋へ入るや言ったあの言葉、わかっているね、ワトソン。そこに本があるだろう。少し疲れた。絶縁体に電気を流す電池の気持ちとは、こんな感じだろうか。六時だ、ワトソン、そのときまた話す。」<br>　だがその時刻よりもずいぶん早く話すことになった。その様は、先ほどホームズが扉へ駆け寄ったときに負けず劣らず肝を抜かれた。私はしばらくのあいだ寝台にじっと横たわっている病人を見てたたずんでいた。顔はほとんど寝具で覆われ、眠り込んでいるように見えた。座って読書をする気にもなれず、室内を歩き回り、四方の壁に掛けられた有名な犯罪者たちの写真を見物していた。あてもなくうろつき、やがて炉棚のところへ来た。パイプ架け、刻み煙草入れ、注射器、折りたたみナイフ、リヴォルヴァの弾薬、その他がらくたがその上に散らかっていた。それらの真ん中に、すべり蓋のついた白黒で象牙の小箱があった。しゃれた小物で、詳しく見ようと私が手を伸ばすと――ものすごい叫び声が上がった――外の通りにまで聞こえそうなわめき声だ。そのすさまじさに全身がぞくりとして髪が逆立つ。振り返ると目の前に、引きつった顔と色を失った目が現れる。手に小箱を持ったまま、私はその場に立ちすくんだ。</p><h2 id="見出し-大"><a href="#見出し-大" class="headerlink" title="見出し (大)"></a>見出し (大)</h2><h3 id="見出し-中"><a href="#見出し-中" class="headerlink" title="見出し (中)"></a>見出し (中)</h3><h4 id="見出し-小"><a href="#見出し-小" class="headerlink" title="見出し (小)"></a>見出し (小)</h4>]]></content>
    
    
    <summary type="html">&lt;p&gt;記事概要&lt;/p&gt;</summary>
    
    
    
    
    <category term="Information" scheme="https://jpabrs-scem.github.io/blog/tags/Information/"/>
    
    <category term="Example" scheme="https://jpabrs-scem.github.io/blog/tags/Example/"/>
    
  </entry>
  
  <entry>
    <title>SQL Server DB に対する Azure Backupを、Proxy Serverをバイパスして PE 経由でバックアップする場合の設定</title>
    <link href="https://jpabrs-scem.github.io/blog/AzureSQLBackup/How_to_PE_SQL_backup_bypass_proxy/"/>
    <id>https://jpabrs-scem.github.io/blog/AzureSQLBackup/How_to_PE_SQL_backup_bypass_proxy/</id>
    <published>2022-10-27T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Azure Backup サポートです。<br>今回は、SQL Server DB に対する Azure Backupを、Proxy Serverをパイパスして PE 経由でバックアップする場合の設定方法についてお伝えします。</p><h4 id="ポイント"><a href="#ポイント" class="headerlink" title="ポイント"></a>ポイント</h4><h5 id="ポイントその-1"><a href="#ポイントその-1" class="headerlink" title="( ポイントその 1 )"></a>( ポイントその 1 )</h5><p>Poxyを経由させてSQL Server DB に対する Azure Backupを行いたい場合は、下記2種類のアカウントに対して、クライアントOS上でProxy設定を行う必要があります。<br>　１つ目：Local System アカウント<br>　２つ目：NT Service\AzureWLBackupPluginSvcアカウント</p><p>そのため、Proxyは経由せず（＝「Proxyをバイパスする」）、バックアップを取得したい場合は、上記 ２ つのアカウントに対してバイパス設定を行う必要があります。<br>※もともと２つのアカウントに対してProxy Server 設定を行っていないのであれば、SQL Server DB に対する Azure BackupにおいてProxyを経由してバックアップすることはありません。</p><p>上記２つのアカウントに対してProxyを設定している、かつ　Proxy を経由せずに、プライベート エンドポイント（PE）経由でSQL Backupをさせたい場合、下記をバイパスさせる必要があります。<br>（例外リスト/バイパスリスト）<br>    　LocalHost 、Wire Server （168.63.129.16）、169.254.169.254、以下ドキュメント記載のAzure Backup、Azure Storage、Azure Active Directory</p><p>・プライベート エンドポイントを使用して Recovery Services コンテナー用のプロキシ サーバーを設定する<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints#set-up-proxy-server-for-recovery-services-vault-with-private-endpoint">https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints#set-up-proxy-server-for-recovery-services-vault-with-private-endpoint</a> </p><h5 id="ポイントその-2"><a href="#ポイントその-2" class="headerlink" title="( ポイントその 2 )"></a>( ポイントその 2 )</h5><p>本ブログ記事作成時点 (2022/10) では、Azure Active Directory ( =AAD ) はプライベート エンドポイントに対応していませんので、AAD は PE 以外の疎通ルートを確立させる必要があります。</p><h2 id="目次-手順概略"><a href="#目次-手順概略" class="headerlink" title="目次 - 手順概略"></a>目次 - 手順概略</h2><hr><p><a href="#1">1. Recovery Services コンテナー上にプライベート エンドポイントを作成</a><br><a href="#2">2．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、Local System アカウントに対して、SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</a><br><a href="#3">3. 「データベースの検出」「バックアップの有効化」</a><br><a href="#4">4. バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、サービスアカウント ( NT Service\AzureWLBackupPluginSvc ) に対して、 SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</a><br><a href="#5">5. SQL Server DB に対する Azure Backup「今すぐバックアップ」を実行</a></p><hr><h2 id="1-Recovery-Services-コンテナー上にプライベート-エンドポイントを作成"><a href="#1-Recovery-Services-コンテナー上にプライベート-エンドポイントを作成" class="headerlink" title=" 1. Recovery Services コンテナー上にプライベート エンドポイントを作成"></a><a id="1"></a> 1. Recovery Services コンテナー上にプライベート エンドポイントを作成</h2><p>こちらは 弊社公開ドキュメントに詳細手順を公開しておりますので、下記をご参考に作成ください。<br>・Azure Backup のプライベート エンドポイントの作成と使用<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints">https://docs.microsoft.com/ja-jp/azure/backup/private-endpoints</a> </p><h2 id="2．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、Local-System-アカウントに対して、SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定"><a href="#2．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、Local-System-アカウントに対して、SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定" class="headerlink" title=" 2．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、Local System アカウントに対して、SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定"></a><a id="2"></a> 2．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、Local System アカウントに対して、SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</h2><h5 id="Local-System-アカウント-に対する-Proxy-Server-バイパス設定-手順詳細"><a href="#Local-System-アカウント-に対する-Proxy-Server-バイパス設定-手順詳細" class="headerlink" title="Local System アカウント に対する Proxy Server バイパス設定 手順詳細"></a>Local System アカウント に対する Proxy Server バイパス設定 手順詳細</h5><p>以下より PsExec をダウンロードします。​<br>​　・PsExec v2.2<br>　　<a href="https://docs.microsoft.com/ja-jp/sysinternals/downloads/psexec">https://docs.microsoft.com/ja-jp/sysinternals/downloads/psexec</a> </p><p>管理者特権のプロンプトから ダウンロードしたファイルを解凍したフォルダに移動し 、次のコマンドを実行して Internet Explorer を開きます。​<br>（実行コマンド）</p><blockquote><p>psexec -i -s “c:\Program Files\Internet Explorer\iexplore.exe”​</p></blockquote><p>Internet Explorer で、[ツール] &gt; [インターネット オプション] &gt; [接続] &gt; [LAN の設定] の順に移動します。​<br>システム アカウントの Proxy 設定を確認します。<br>Proxy の IP アドレスとポートを設定します。​</p><p>・下図例では、Proxy Server の IP アドレスが「10.2.0.16」である前提の画面スクリーンショットとなっています。<br>・下図中央の「Local Area Network (LAN) Settings」ウィンドウ ＞ 「Byspass proxy server for local addresses」チェックボックスを ON とします。<br>　これは、下記公開ドキュメント「VM 内の localhost 通信のプロキシを無効にします。」と記載している設定に該当しています。<br>　・トラフィックをルーティングするために HTTP プロキシ サーバーを使用する<br>　　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic">https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic</a></p><p>・下図一番右側の「Proxy Settings」ウィンドウ ＞ 「Exceptions」欄に記入すべきものが、SQL Server DB に対する Azure Backup 実行時 (= Local Sysytem アカウントが利用される際) に、Proxy Server を経由させずに通信したい場合のアドレスを入力する欄です。<br>　ここに、以下を記入することで、SQL Server DB に対する Azure Backup 実行時はプロキシをバイパスさせることができます。<br>　LocalHost 、Wire Server （168.63.129.16）、169.254.169.254、上記ドキュメント記載のAzure Backup、Azure Storage、AAD<br>（実際の入力値）</p><blockquote><p>​localhost;168.63.129.16;169.254.169.254;<em>.backup.windowsazure.com;</em>.queue.core.windows.net;<em>.blob.core.windows.net;</em>.blob.storage.azure.net;<em>.msftidentity.com;</em>.msidentity.com;account.activedirectory.windowsazure.com;accounts.accesscontrol.windows.net;adminwebservice.microsoftonline.com;api.passwordreset.microsoftonline.com;autologon.microsoftazuread-sso.com;becws.microsoftonline.com;clientconfig.microsoftonline-p.net;companymanager.microsoftonline.com;device.login.microsoftonline.com;graph.microsoft.com;graph.windows.net;login.microsoft.com;login.microsoftonline.com;login.microsoftonline-p.com;login.windows.net;logincert.microsoftonline.com;loginex.microsoftonline.com;login-us.microsoftonline.com;nexus.microsoftonline-p.com;passwordreset.microsoftonline.com;provisioningapi.microsoftonline.com;20.190.128.<em>;40.126.</em>;<em>.hip.live.com;</em>.microsoftonline.com;<em>.microsoftonline-p.com;</em>.msauth.net;<em>.msauthimages.net;</em>.msecnd.net;<em>.msftauth.net;</em>.msftauthimages.net;*.phonefactor.net;enterpriseregistration.windows.net;management.azure.com;policykeyservice.dc.ad.msft.net</p></blockquote><p><img src="https://user-images.githubusercontent.com/96324317/197693453-7e4e98b9-a52b-4965-bd0a-f5751bfd4c90.png"></p><h2 id="3．「データベースの検出」「バックアップの有効化」"><a href="#3．「データベースの検出」「バックアップの有効化」" class="headerlink" title=" 3．「データベースの検出」「バックアップの有効化」"></a><a id="3"></a> 3．「データベースの検出」「バックアップの有効化」</h2><p>Azure ポータル画面上から、対象の SQL Server DB に対して「データベースの検出」「バックアップの有効化」を行います。</p><p>・コンテナーから複数の SQL Server VM をバックアップする - Azure Backup | Microsoft Docs<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#discover-sql-server-databases">https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#discover-sql-server-databases</a> </p><h2 id="4．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、サービスアカウント-NT-Service-AzureWLBackupPluginSvc-に対して、-SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定"><a href="#4．バックアップ対象の-SQL-Server-DB-が存在する-Azure-仮想マシン上で、サービスアカウント-NT-Service-AzureWLBackupPluginSvc-に対して、-SQL-Server-DB-に対する-Azure-Backup-サービスがバイパスされるよう、設定" class="headerlink" title=" 4．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、サービスアカウント ( NT Service\AzureWLBackupPluginSvc ) に対して、 SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定"></a><a id="4"></a> 4．バックアップ対象の SQL Server DB が存在する Azure 仮想マシン上で、サービスアカウント ( NT Service\AzureWLBackupPluginSvc ) に対して、 SQL Server DB に対する Azure Backup サービスがバイパスされるよう、設定</h2><p>「バックアップの有効化」が成功後、Azure Backup サービスによって対象マシン上に生成済の「NT Service\AzureWLBackupPluginSvc」アカウントに対する、Proxy Server のバイパス設定を行います。<br>バイパスリストは  Local Sysytem アカウントに対して設定した内容と同一です。<br>下記に、「NT Service\AzureWLBackupPluginSvc」アカウントへの設定手順の一例を記載します。<br>一例としては、カレントユーザーに対して行ったProxy設定を、コマンド実行によって「NT Service\AzureWLBackupPluginSvc」アカウントに対して引き継ぐ手順です。<br>そのため、一時的にまずはカレントユーザーに対しても、Proxy Server のバイパス設定を行います。</p><h5 id="一例-「NT-Service-AzureWLBackupPluginSvc」アカウントに対する-Proxy-バイパス設定-手順詳細"><a href="#一例-「NT-Service-AzureWLBackupPluginSvc」アカウントに対する-Proxy-バイパス設定-手順詳細" class="headerlink" title="(一例) 「NT Service\AzureWLBackupPluginSvc」アカウントに対する Proxy バイパス設定 手順詳細"></a>(一例) 「NT Service\AzureWLBackupPluginSvc」アカウントに対する Proxy バイパス設定 手順詳細</h5><p>まずは「NT Service\AzureWLBackupPluginSvc」アカウントが存在しているかを、念のため確認します。<br>対象マシン上で、スタートボタンを右クリック ＞ ファイル名を指定して実行 ＞ 「regedit」を入力し「OK」をクリックします。<br><img src="https://user-images.githubusercontent.com/96324317/197693696-1df4ae35-e8c8-4afc-b4ff-cf21ab2f912d.png"></p><p><img src="https://user-images.githubusercontent.com/96324317/197693727-6c4cef17-55b3-4865-be4d-660435ad3b4a.png"></p><p>レジストリ エディターが開きますので、以下パスへ遷移します。<br>（対象パス）<br>        HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151</p><p>上記レジストリキー (フォルダー)「S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151」が、「NT Service\AzureWLBackupPluginSvc」アカウントを表しています。<br>この時点で存在していない場合、「データベースの検出」「バックアップの有効化」もしくは「再登録」が正常完了していない可能性がありますので、「データベースの検出」「バックアップの有効化」「再登録」が成功しているかどうかを再度確認・再実行願います。<br><img src="https://user-images.githubusercontent.com/96324317/197693875-49891f05-2b67-4040-9641-1f99ca7b271a.png"></p><p>レジストリ エディター上でレジストリキー (フォルダー)「S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151」が存在していることを確認出来たら、一時的に カレントユーザーに対して Proxy Server の設定を行います。</p><p>・設定内容は、Local System アカウント に対する Proxy Server バイパス設定と同一です<br>・下図例 では、Proxy Server の IP アドレスが「10.2.0.16」である前提の画面スクリーンショットとなっています。<br>・下図中央の「Don’t use the proxy server for local (intranet) addresses」チェックボックスを ON とします。<br>　これは、下記公開ドキュメント「VM 内の localhost 通信のプロキシを無効にします。」と記載している設定に該当しています。<br>　・トラフィックをルーティングするために HTTP プロキシ サーバーを使用する<br>　　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic">https://docs.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#use-an-http-proxy-server-to-route-traffic</a></p><p>・下図一番右側 黄色罫線箇所が、Proxy Server を経由させずに通信したい場合のアドレスを入力する欄です。<br>　ここに、以下を記入することで、SQL Server DB に対する Azure Backup 実行時はプロキシをバイパスさせることができます。<br>　LocalHost 、Wire Server （168.63.129.16）、169.254.169.254、上記ドキュメント記載のAzure Backup、Azure Storage、AAD<br>（実際の入力値）</p><blockquote><p>​localhost;168.63.129.16;169.254.169.254;<em>.backup.windowsazure.com;</em>.queue.core.windows.net;<em>.blob.core.windows.net;</em>.blob.storage.azure.net;<em>.msftidentity.com;</em>.msidentity.com;account.activedirectory.windowsazure.com;accounts.accesscontrol.windows.net;adminwebservice.microsoftonline.com;api.passwordreset.microsoftonline.com;autologon.microsoftazuread-sso.com;becws.microsoftonline.com;clientconfig.microsoftonline-p.net;companymanager.microsoftonline.com;device.login.microsoftonline.com;graph.microsoft.com;graph.windows.net;login.microsoft.com;login.microsoftonline.com;login.microsoftonline-p.com;login.windows.net;logincert.microsoftonline.com;loginex.microsoftonline.com;login-us.microsoftonline.com;nexus.microsoftonline-p.com;passwordreset.microsoftonline.com;provisioningapi.microsoftonline.com;20.190.128.<em>;40.126.</em>;<em>.hip.live.com;</em>.microsoftonline.com;<em>.microsoftonline-p.com;</em>.msauth.net;<em>.msauthimages.net;</em>.msecnd.net;<em>.msftauth.net;</em>.msftauthimages.net;*.phonefactor.net;enterpriseregistration.windows.net;management.azure.com;policykeyservice.dc.ad.msft.net</p></blockquote><p><img src="https://user-images.githubusercontent.com/96324317/197693971-4fcf367e-2685-4284-b0f4-4e8c0c457e38.png"></p><p>カレントユーザーに対して、Proxy Server のバイパス設定を保存した後に、PowerShell を立ち上げ、以下コマンドを実行します。<br>下記コマンドを実行することで、カレントユーザーに対して行った設定が、「NT Service\AzureWLBackupPluginSvc」アカウントへ引き継がれます。</p><p>（実行コマンド）</p><blockquote><p>$obj = Get-ItemProperty -Path Registry::”HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections”<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections” -Name DefaultConnectionSettings -Value $obj.DefaultConnectionSettings<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections” -Name SavedLegacySettings -Value $obj.SavedLegacySettings<br>$obj = Get-ItemProperty -Path Registry::”HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings”<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings” -Name ProxyEnable -Value $obj.ProxyEnable<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings” -Name Proxyserver -Value $obj.Proxyserver<br>Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-80-1631947889-4033244730-3205203906-53534054-4184208151\Software\Microsoft\Windows\CurrentVersion\Internet Settings” -Name ProxyOverride -Value $obj.ProxyOverride</p></blockquote><p><img src="https://user-images.githubusercontent.com/96324317/197694217-0ac20679-c842-419b-a6f4-a68bf609eccb.png"></p><p>上記コマンド実行後、カレントユーザーに対する Proxy Server 設定を、元の状態に戻します。<br>念のため、以下スクリプトを実行いただき、Local System アカウントとNT Service\AzureWLBackupPluginSvcアカウントに対して、Proxy Server バイパス設定が正しく設定されているかを確認します。</p><h5 id="１．下記ドキュメント上の「Azure-Backup-接続テスト-スクリプト-AzureBackupConnectivityTestScriptsForWindows-zip-」を対象-Azure-仮想マシン上にダウンロードし、-zip-ファイルを展開します。"><a href="#１．下記ドキュメント上の「Azure-Backup-接続テスト-スクリプト-AzureBackupConnectivityTestScriptsForWindows-zip-」を対象-Azure-仮想マシン上にダウンロードし、-zip-ファイルを展開します。" class="headerlink" title="１．下記ドキュメント上の「Azure Backup 接続テスト スクリプト (AzureBackupConnectivityTestScriptsForWindows.zip) 」を対象 Azure 仮想マシン上にダウンロードし、 zip ファイルを展開します。"></a>１．下記ドキュメント上の「Azure Backup 接続テスト スクリプト (AzureBackupConnectivityTestScriptsForWindows.zip) 」を対象 Azure 仮想マシン上にダウンロードし、 zip ファイルを展開します。</h5><p>・ネットワーク接続を確立する<br>　<a href="https://learn.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#establish-network-connectivity">https://learn.microsoft.com/ja-jp/azure/backup/backup-sql-server-database-azure-vms#establish-network-connectivity</a></p><h5 id="２．展開した-zip-ファイル内の「Start-ConnectivityTests-ps1」を、対象-Azure-仮想マシン上で実行します。"><a href="#２．展開した-zip-ファイル内の「Start-ConnectivityTests-ps1」を、対象-Azure-仮想マシン上で実行します。" class="headerlink" title="２．展開した zip ファイル内の「Start-ConnectivityTests.ps1」を、対象 Azure 仮想マシン上で実行します。"></a>２．展開した zip ファイル内の「Start-ConnectivityTests.ps1」を、対象 Azure 仮想マシン上で実行します。</h5><p>今回は、Azure Backup サービスと Azure Storage サービスに対しては、プライベート エンドポイント経由で通信するため、引数に「-IsPrivateEndpointEnabled」を追加して実行します。<br>（実行コマンド 例）<br>        .\Start-ConnectivityTests.ps1 -IsPrivateEndpointEnabled</p><p><img src="https://user-images.githubusercontent.com/96324317/197697047-3663b672-184f-499b-b405-e95770135b27.png"></p><p><img src="https://user-images.githubusercontent.com/96324317/197704009-4d226d75-3057-4439-88ae-b2a42af0f7e5.png"></p><p>「Start-ConnectivityTests.ps1」スクリプトを実行後、ターミナル上に結果が返却されます。</p><h5 id="「Start-ConnectivityTests-ps1」実行結果の期待値"><a href="#「Start-ConnectivityTests-ps1」実行結果の期待値" class="headerlink" title="「Start-ConnectivityTests.ps1」実行結果の期待値"></a>「Start-ConnectivityTests.ps1」実行結果の期待値</h5><p>（１）<br>WinInet settings for NT Authority\System (used by Azure Workload Backup Coordinator service)<br>ProxyEnable: <span style="color: red; ">1</span><br>となっていること。(=プロキシ設定 ON を表す)</p><p>（２）<br>WinInet settings for NT Authority\System (used by Azure Workload Backup Coordinator service)<br>「ProxyOverride:」以降が、設定した例外リスト/バイパスリストの内容となっていること</p><p>（３）<br>WinInet settings for NT Service\AzureWLBackupPluginSvc (used by Azure Workload Backup Plugin service)<br>ProxyEnable: <span style="color: red; ">1</span><br>となっていること。(=プロキシ設定 ON を表す)</p><p>（４）<br>WinInet settings for NT Service\AzureWLBackupPluginSv (used by Azure Workload Backup Plugin service)<br>「ProxyOverride:」以降が、設定した例外リスト/バイパスリストの内容となっていること<br><img src="https://user-images.githubusercontent.com/96324317/197704402-d3ac2ec2-6778-4bfa-bf48-356c975f8d4a.png"></p><h2 id="5．SQL-Server-DB-に対する-Azure-Backup「今すぐバックアップ」を実行"><a href="#5．SQL-Server-DB-に対する-Azure-Backup「今すぐバックアップ」を実行" class="headerlink" title=" 5．SQL Server DB に対する Azure Backup「今すぐバックアップ」を実行"></a><a id="5"></a> 5．SQL Server DB に対する Azure Backup「今すぐバックアップ」を実行</h2><p>Azure ポータル画面上で設定した、バックアップ ポリシーに従った次回の スケジュールバックアップが成功することを確認いただく、もしくは「今すぐバックアップ」を実行してオンデマンド バックアップが成功することをご確認ください。</p><p>・オンデマンド バックアップを実行する<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/tutorial-sql-backup#run-an-on-demand-backup">https://docs.microsoft.com/ja-jp/azure/backup/tutorial-sql-backup#run-an-on-demand-backup</a></p><p>SQL Server DB に対する Azure Backupを、Proxy Serverをパイパスして PE 経由でバックアップする場合の設定方法は以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Azure Backup サポートです。&lt;br&gt;今回は、SQL Server DB に対する Azure Backupを、Proxy Serverをパイパスして PE 経由でバックアップする場合の設定方法につい</summary>
      
    
    
    
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
    <category term="Azure SQL バックアップ" scheme="https://jpabrs-scem.github.io/blog/tags/Azure-SQL-%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の 保持期間について</title>
    <link href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/Backup_RetentionPeriod/"/>
    <id>https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/Backup_RetentionPeriod/</id>
    <published>2022-10-25T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートです。<br>今回は、よくお問い合わせをうける「保持期限」について、取りまとめてお伝えします。<br>公開ドキュメント上では、下記のように「最大保有期間：バックアップ頻度次第」と記載が書かれており、実際に「毎日」「毎週」のバックアップを構成した場合の最大保有期間は、ポリシー作成画面で確認するのみとなっております。</p><p>・保有の制限<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-support-matrix#retention-limits">https://docs.microsoft.com/ja-jp/azure/backup/backup-support-matrix#retention-limits</a></p><p><img src="https://user-images.githubusercontent.com/96324317/197381027-dcf0c231-950e-4b50-a14f-4f2d991c9616.png"></p><p>（図例：Azure VM Backup の場合）<br><img src="https://user-images.githubusercontent.com/96324317/197453814-73c643d9-ad3f-458c-b729-4fb7a409aab6.png"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Azure VM Backup の場合</a><br><a href="#2">2. Azure ファイル共有に対する Azure Backup の場合</a><br><a href="#3">3. SQL Server DB に対する Azure Backup の場合</a><br><a href="#4">4. SAP HANA DB に対する Azure Backup の場合</a><br><a href="#5">5. Microsoft Azure Recovery Services (MARS) の場合</a></p><hr><h2 id="1-Azure-VM-Backup-の場合"><a href="#1-Azure-VM-Backup-の場合" class="headerlink" title=" 1. Azure VM Backup の場合"></a><a id="1"></a> 1. Azure VM Backup の場合</h2><table><thead><tr><th>Azure VM に対するバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>インスタント回復スナップショットの保有期間</td><td>1 日</td><td>ポリシーのサブタイプ：Standard の場合： 5<br>ポリシーのサブタイプ：Enhanced の場合： 30 日</td></tr><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>1 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>1188 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>99 年</td></tr></tbody></table><p>（補足）オンデマンド バックアップの場合、最大 99 年まで保持期間を指定可能です。<br><img src="https://user-images.githubusercontent.com/96324317/197448093-5b532557-b4e6-44de-b837-01993756862a.png"></p><h2 id="2-Azure-ファイル共有に対する-Azure-Backup-の場合"><a href="#2-Azure-ファイル共有に対する-Azure-Backup-の場合" class="headerlink" title=" 2. Azure ファイル共有に対する Azure Backup の場合"></a><a id="2"></a> 2. Azure ファイル共有に対する Azure Backup の場合</h2><table><thead><tr><th>Azure ファイル共有 に対するバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>1 日</td><td>200 日</td></tr><tr><td>毎週</td><td>1 週</td><td>200 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>120 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>10 年</td></tr></tbody></table><h2 id="3-SQL-Server-DB-に対する-Azure-Backup-の場合"><a href="#3-SQL-Server-DB-に対する-Azure-Backup-の場合" class="headerlink" title=" 3. SQL Server DB に対する Azure Backup の場合"></a><a id="3"></a> 3. SQL Server DB に対する Azure Backup の場合</h2><table><thead><tr><th>完全バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>1 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>1188 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>99 年</td></tr></tbody></table><table><thead><tr><th>差分バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎週</td><td>7 日</td><td>180 日</td></tr></tbody></table><table><thead><tr><th>ログバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎分/毎時</td><td>7 日</td><td>35 日</td></tr></tbody></table><h2 id="4-SAP-HANA-DB-に対する-Azure-Backup-の場合"><a href="#4-SAP-HANA-DB-に対する-Azure-Backup-の場合" class="headerlink" title=" 4. SAP HANA DB に対する Azure Backup の場合"></a><a id="4"></a> 4. SAP HANA DB に対する Azure Backup の場合</h2><table><thead><tr><th>完全バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>1 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>1 ヶ月</td><td>1188 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>99 年</td></tr></tbody></table><table><thead><tr><th>差分バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎週</td><td>7 日</td><td>180 日</td></tr></tbody></table><table><thead><tr><th>増分バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎週</td><td>7 日</td><td>180 日</td></tr></tbody></table><table><thead><tr><th>ログバックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎分/毎時</td><td>7 日</td><td>35 日</td></tr></tbody></table><h2 id="5-Microsoft-Azure-Recovery-Services-MARS-の場合"><a href="#5-Microsoft-Azure-Recovery-Services-MARS-の場合" class="headerlink" title=" 5. Microsoft Azure Recovery Services (MARS) の場合"></a><a id="5"></a> 5. Microsoft Azure Recovery Services (MARS) の場合</h2><table><thead><tr><th>MARS バックアップの頻度</th><th>最小保持期間</th><th>最大保持期間</th></tr></thead><tbody><tr><td>毎日</td><td>7 日</td><td>9999 日</td></tr><tr><td>毎週</td><td>4 週</td><td>5163 週</td></tr><tr><td>毎月</td><td>3 ヶ月</td><td>1316 ヶ月</td></tr><tr><td>毎年</td><td>1 年</td><td>100 年</td></tr></tbody></table><p>Azure Backup における保有期間について、以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートです。&lt;br&gt;今回は、よくお問い合わせをうける「保持期限」について、取りまとめてお伝えします。&lt;br&gt;公開ドキュメント上では、下記のように「最大保有期間：バックアップ頻度次第」</summary>
      
    
    
    
    
    <category term="Recovery Services vaults" scheme="https://jpabrs-scem.github.io/blog/tags/Recovery-Services-vaults/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Azure VM Backup と Azure Site Recovery による DR 要件について</title>
    <link href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/DR_ASR_or_VMBackup/"/>
    <id>https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/DR_ASR_or_VMBackup/</id>
    <published>2022-08-08T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>こんにちは。Azure VM 、Azure Site Recovery 担当です。<br>今回は Azure のリージョン障害などを想定した Azure VM の Disaster Recovery (DR) 対策を検討中のお客様よりお問合せをいただきます「Azure VM Backup と Azure Site Recovery どちらを利用すればいいのか？」について解説させていただきます。</p><p>結論としては、お客様の DR 要件である RTO, RPO をクリアにしていただく必要があり、ここがクリアになれば Azure VM Backup と Azure Site Recovery どちらを選択すればいいか判断できるようになると存じます。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. DR, RTO, RPO について</a><br>   <a href="#1-1">  1.1 Disaster Recovery (DR)</a><br>   <a href="#1-2">  1.2 Recovery Time Objective (RTO)</a><br>   <a href="#1-3">  1.3 Recovery Point Objective (RPO)</a><br><a href="#2">2. Azure VM Backup と Azure Site Recovery の比較</a><br><a href="#2">3. 参考情報 : DR 大作のための Azure VM のディスクの冗長構成は非推奨</a></p><hr><h2 id="1-DR-RTO-RPO-について"><a href="#1-DR-RTO-RPO-について" class="headerlink" title=" 1. DR, RTO, RPO について"></a><a id="1"></a> 1. DR, RTO, RPO について</h2><p>まずは前提知識について DR, RTO, RPO について簡単に説明いたします。</p><h3 id="Disaster-Recovery-DR"><a href="#Disaster-Recovery-DR" class="headerlink" title=" Disaster Recovery (DR)"></a><a id="1-1"></a> Disaster Recovery (DR)</h3><p>大規模災害などの影響によりシステムやデータセンターが障害を受けた際に、利用できなくなったシステムを素早く復旧するための計画やそのような状態を未然に防ぐことを指します。<br>事業者様によって整備されている、BCP (事業継続計画) をご確認いただくことで後の RTO, RPO の指標が明確になるかと存じます。</p><h3 id="Recovery-Time-Objective-RTO"><a href="#Recovery-Time-Objective-RTO" class="headerlink" title=" Recovery Time Objective (RTO)"></a><a id="1-2"></a> Recovery Time Objective (RTO)</h3><p>「目標復旧時間」のことで、大規模災害などの影響によりシステムやデータセンターが障害を受けシステムが停止した時に、その時点から復旧までにかかる時間のことを指します。どのくらいの時間がダウンタイムとして許容できるかをご確認いただくのが良いかと存じます。</p><ul><li>ダウンタイムの許容時間は最大 24 時間。など</li></ul><h3 id="Recovery-Point-Objective-RPO"><a href="#Recovery-Point-Objective-RPO" class="headerlink" title=" Recovery Point Objective (RPO)"></a><a id="1-3"></a> Recovery Point Objective (RPO)</h3><p>「目標復旧時点」のことで、大規模災害などの影響によりシステムやデータセンターが障害を受けシステムが停止した時に、過去のどの時点のデータまでを復旧できるかを指します。障害時点から復旧ポイントまでの間の時間のデータは復旧できないことになるため、データ復旧ができなくても許容できる時間をご確認いただくのが良いかと存じます。</p><ul><li>データ損失の許容時間は直前 12 時間以内。など</li></ul><h2 id="2-Azure-VM-Backup-と-Azure-Site-Recovery-の比較"><a href="#2-Azure-VM-Backup-と-Azure-Site-Recovery-の比較" class="headerlink" title=" 2. Azure VM Backup と Azure Site Recovery の比較"></a><a id="2"></a> 2. Azure VM Backup と Azure Site Recovery の比較</h2><p>以下は Azure VM Backup と Azure Site Recovery の比較表です。<br>2 時間以上のダウンタイム (RTO) が許容されない場合や、24 時間以上のデータ損失が許容されない場合など Azure VM Backup で対応できない場合には Azure Site Recovery の採用をご検討いただければと存じます。</p><table><thead><tr><th align="left">#</th><th align="left">Azure VM Backup</th><th align="left">Azure Site Recovery</th></tr></thead><tbody><tr><td align="left">機能</td><td align="left">Azure VM のバックアップを取得します。<br>Recovery Services コンテナーを GRS (または RA-GRS) にすることで、ペア リージョンへのバックアップ データのレプリケーションが行われペア リージョンでの復元ができるようになります。<br>[ご参考] ・ Azure VM Backup における CRR (クロスリージョン リストア) について<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/CRR/">https://jpabrs-scem.github.io/blog/AzureVMBackup/CRR/</a></td><td align="left">Azure VM のデータをターゲット リージョンのディスクへレプリケーションします。</td></tr><tr><td align="left">復旧ポイントの保持期間</td><td align="left">最大 99 年保持することができます。</td><td align="left">Unmanaged Disk では最大 72 時間 (3 日) 保持することができます。<br>Managed Disk では最大 15 日保持することができます。</td></tr><tr><td align="left">RTO に関する SLA</td><td align="left">RTO について SLA はありません。</td><td align="left">SLA で 2 時間以内の RTO を保証します。<br> [ご参考] ・Azure Site Recovery の SLA<br><a href="https://azure.microsoft.com/ja-jp/support/legal/sla/site-recovery/v1_2/">https://azure.microsoft.com/ja-jp/support/legal/sla/site-recovery/v1_2/</a><br>&gt;オンプレミスと Azure 間の計画上および計画外のフェールオーバー用に構成された保護された各インスタンスにつき、マイクロソフトは、2 時間の目標復旧時間を保証します。</td></tr><tr><td align="left">Recovery Time Objective (RTO)</td><td align="left">24時間以内に完了する仕様となっております。<br> <strong>大容量の VM では復元に 24 時間以上かかる場合がございます。</strong><br>[ご参考] ・1.1 Azure VM Backup のバックアップ時間について<br>Azure Backup の バックアップ / リストア 所要時間について　<br><a href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/Backup_RecoveryTIme/#1-1">https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/Backup_RecoveryTIme/#1-1</a></td><td align="left">2 時間以内の RTO を提供します。</td></tr><tr><td align="left">Recovery Point Objective (RPO)</td><td align="left">スタンダードポリシーをご利用の場合、バックアップのスケジュールは 1 日 1 回となります。<br>その場合、最短の復元ポイント時点が 24 時間以上前となる場合がございます。<br>エンハンスド ポリシー(拡張ポリシー)をご利用の場合、バックアップのスケジュールは再頻 4 時間おきのバックアップが可能です。<br> [ご参考] ・拡張ポリシーを使用して Azure VM をバックアップする<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-enhanced-policy">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-enhanced-policy</a></td><td align="left">クラッシュ整合性復旧ポイントは 5 分ごとに取得されます。<br>アプリ整合性復旧ポイントは、レプリケーション ポリシーにて設定でき最短で 1 時間ごとにスケジュールできます。</td></tr></tbody></table><h2 id="3-参考情報-DR-対策のための-Azure-VM-のディスクの冗長構成は非推奨"><a href="#3-参考情報-DR-対策のための-Azure-VM-のディスクの冗長構成は非推奨" class="headerlink" title=" 3. 参考情報 : DR 対策のための Azure VM のディスクの冗長構成は非推奨"></a><a id="3"></a> 3. 参考情報 : DR 対策のための Azure VM のディスクの冗長構成は非推奨</h2><p>Azure VM では、Unmanaged Disk を利用している場合にストレージ アカウントの GRS は非推奨構成です。<br>そのため、Azure VM の DR 要件に関してはディスクの Azure VM Backup または ASR の利用をご検討いただき、ディスク単位での冗長構成については検討対象から外していただいた方が良いかと存じます。 </p><p>・ローカル冗長ストレージ - ローカル冗長ストレージ<br><a href="https://docs.microsoft.com/ja-jp/azure/storage/common/storage-redundancy#locally-redundant-storage">https://docs.microsoft.com/ja-jp/azure/storage/common/storage-redundancy#locally-redundant-storage</a></p><blockquote><p>シナリオで Azure アンマネージド ディスクを使用している場合は、LRS を選択できます。 GRS を使用する Azure アンマネージド ディスクのストレージ アカウントを作成することはできますが、非同期 geo レプリケーションの整合性に関する潜在的な問題のため、お勧めしません。</p></blockquote><p>本記事の内容は以上となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;こんにちは。Azure VM 、Azure Site Recovery 担当です。&lt;br&gt;今回は Azure のリージョン障害などを想定した Azure VM の Disaster Recovery (DR) 対策を検討中のお</summary>
      
    
    
    
    
    <category term="Recovery Services vaults" scheme="https://jpabrs-scem.github.io/blog/tags/Recovery-Services-vaults/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の バックアップ / リストア 所要時間について</title>
    <link href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/Backup_RecoveryTIme/"/>
    <id>https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/Backup_RecoveryTIme/</id>
    <published>2022-06-25T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回はお問い合わせをいただくことが多い、Azure Backup におけるバックアップやリストアにかかる時間についてご説明いたします。 Azure VM Backup に限らず、 各 Azure Backup サービスにおける各所要時間を見積もることはかないません。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. 転送データ量とバックアップやリストアにかかる時間</a><br>   <a href="#1-2">  1.2 バックアップ タイムの実績値グラフ</a><br>   <a href="#1-3">  1.3 リストア タイムの実績値グラフ</a><br><a href="#2">2. データディスクの数とバックアップやリストアにかかる時間</a><br>   <a href="#2-1">  2.1 リストア検証</a> </p><hr><h2 id="1-転送データ量とバックアップやリストアにかかる時間"><a href="#1-転送データ量とバックアップやリストアにかかる時間" class="headerlink" title=" 1. 転送データ量とバックアップやリストアにかかる時間"></a><a id="1"></a> 1. 転送データ量とバックアップやリストアにかかる時間</h2><p>よくお客様より、<strong>時間の目安を見積もりたい、100GB だとどれくらいの時間がかかるか？</strong>といったようなお問い合わせをいただくことがございます。</p><p>こちら結論から申し上げますと、<strong>Azure VM Backup におけるバックアップやリストアの時間を見積もることは出来ません。</strong><br>Azure サービスはマルチテナント サービスであるため、 Azure Backup サービスにおける所要時間はバックアップ / リストア対象のバックアップ アイテム (VM) の転送データサイズのみではなく、他のリソース、他のユーザー様の稼働状況、帯域の状況などにも処理時間は左右されるためです。</p><p>よって、同じリソースの条件においても、そのときどきによってリストアやバックアップにかかる時間は変化する場合がございます。<br>そのため、リストアやバックアップにかかる時間については弊社として指標を出しておりません。</p><h3 id="1-1-Azure-VM-Backup-のバックアップ時間について"><a href="#1-1-Azure-VM-Backup-のバックアップ時間について" class="headerlink" title=" 1.1 Azure VM Backup のバックアップ時間について"></a><a id="1-1"></a> 1.1 Azure VM Backup のバックアップ時間について</h3><p>特に、Azure VM Backup のバックアップ時間に関しましては、増分データが 200GB 以下である場合、24時間 以内に完了する仕様となっており、24 時間以内の完了であれば仕様の範疇でございます。</p><p>・バックアップ パフォーマンス<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-performance">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-performance</a></p><p>・バックアップ プロセス<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-process">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction#backup-process</a></p><blockquote><p>抜粋：”スナップショット データはコンテナーにすぐにコピーされない場合があります。 ピーク時には、数時間かかる場合があります。 毎日のバックアップ ポリシーでは、<strong>VM のバックアップの合計時間は 24 時間未満になります。</strong>“</p></blockquote><p>また、Azure VM Backupでは Take Snapshot と Transfer data to vault の2 つのフェーズがありますが、Take Snapshot にかかった時間を確認する方法については下記をご覧ください。</p><p>・Azure VM Backup における Take Snapshot フェーズの確認方法<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/">https://jpabrs-scem.github.io/blog/AzureVMBackup/How_to_check_VM_backup_Subtask/</a></p><p>次に実際の Azure VM Backup の実際のデータより作成したグラフをご参考までにお伝えさせていただきます。</p><h3 id="1-2-Azure-VM-Backup-におけるバックアップ-タイムの実績値グラフ"><a href="#1-2-Azure-VM-Backup-におけるバックアップ-タイムの実績値グラフ" class="headerlink" title=" 1.2 Azure VM Backup におけるバックアップ タイムの実績値グラフ"></a><a id="1-2"></a> 1.2 Azure VM Backup におけるバックアップ タイムの実績値グラフ</h3><p>Azure VM Backup のバックアップにかかった時間と転送データ量の実績値をグラフにしたものになります。<br><img src="https://user-images.githubusercontent.com/71251920/175569827-32081c88-3b8a-4eca-abdc-471033b3d4b8.png"></p><p> Azure VM のバックアップにおいて <strong>転送データ量とかかった時間に相関がない</strong>ことがわかるかと存じます。</p><p>また、転送データ量が数TBなど (200GB より多い) 場合、24 時間以上かかる事例がございますが、上述の通り、データ量から時間を概算することはかないません。</p><h3 id="1-3-Azure-VM-Backup-におけるリストア-タイムの実績値グラフ"><a href="#1-3-Azure-VM-Backup-におけるリストア-タイムの実績値グラフ" class="headerlink" title=" 1.3 Azure VM Backup におけるリストア タイムの実績値グラフ"></a><a id="1-3"></a> 1.3 Azure VM Backup におけるリストア タイムの実績値グラフ</h3><p>こちら、<strong>インスタント リストア</strong>ではなく Recovery Services コンテナー (標準コンテナー / Vault-Standard) からのリストアでございます。<br>Azure VM Backup のリストアにかかった時間と転送データ量の実績値をグラフにしたものになります。<br><img src="https://user-images.githubusercontent.com/71251920/175569833-99834c3c-46f3-4901-8014-5c0a6dc0cb22.png"><br>リストアにおいても<strong>転送データ量とかかった時間に相関がない</strong>ことがわかるかと存じます。</p><h4 id="インスタント-リストアついて"><a href="#インスタント-リストアついて" class="headerlink" title="インスタント リストアついて"></a>インスタント リストアついて</h4><p>インスタント リストアは Recovery Services コンテナーからの転送フェーズがございませんので、上記のグラフ結果よりも早い復元が期待できる機能でございます。</p><p>下記のように回復の種類に “スナップショット” が含まれる場合は自動的にインスタント リストアとなります。</p><p><img src="https://user-images.githubusercontent.com/71251920/178863089-01be3556-bf72-472a-9e48-888f80dd7875.png"></p><p>・Azure Backup のインスタント リストア機能を使用してバックアップと復元のパフォーマンスを改善する<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-instant-restore-capability">https://docs.microsoft.com/ja-jp/azure/backup/backup-instant-restore-capability</a></p><h2 id="2-データディスクの数とバックアップやリストアにかかる時間"><a href="#2-データディスクの数とバックアップやリストアにかかる時間" class="headerlink" title=" 2. データディスクの数とバックアップやリストアにかかる時間"></a><a id="2"></a> 2. データディスクの数とバックアップやリストアにかかる時間</h2><p>また類似の質問として、Azure VM Backup において<strong>同じデータ量であればディスクの数が多い方が早いか？または遅いか？</strong>といった質問もいただくことがございますが、<a href="#1">1.</a>と同様の理由から一概に<strong>どちらの方が早くなるなどといったことはお伝えできません。</strong><br>しかしながら、他のユーザー様の影響を全く受けない環境である場合、ディスクが多い方がその管理オーバヘッドの分だけ時間がかかると考えられます。</p><h3 id="2-1-リストア検証"><a href="#2-1-リストア検証" class="headerlink" title=" 2.1 リストア検証"></a><a id="2-1"></a> 2.1 リストア検証</h3><p>(検証内容と結果)<br>下記それぞれの内容で 同じVM のリストアを実施し、リストア時間の所要時間を比較いたしました。</p><blockquote><p>#1　アタッチしたディスク：256GiB  × 4 本、 所要時間： 13:43<br>#2　アタッチしたディスク：1024GiB × 1 本、 所要時間： 12:10</p></blockquote><p>その結果、上記の通りのディスクの本数が 4 本のものが 1 本のものに比べ、 1 分 33 秒 多く時間がかかったことが結果として得られました。</p><p>お客様のお役に立てれば幸いです。<br>本記事は以上です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回はお問い合わせをいただくことが多い、Azure Backup におけるバックアップやリストアにかかる時間についてご説明いたします。 Azure VM B</summary>
      
    
    
    
    
    <category term="Recovery Services vaults" scheme="https://jpabrs-scem.github.io/blog/tags/Recovery-Services-vaults/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の障害調査に必要な情報 (疎通確認)</title>
    <link href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigatingNW/"/>
    <id>https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigatingNW/</id>
    <published>2022-06-24T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回は Azure Backup のバックアップ失敗、リストア失敗の時の調査をするにあたり、NW 観点で提供いただきたい情報をお伝えいたします。<br>NW 観点以外の情報採集提供依頼については下記をご覧ください<br>・Azure Backup の障害調査に必要な情報<br><a href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigating/">https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigating/</a></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Windows VM における Azure Backup 疎通確認</a><br><a href="#2">2. Linux VM における Azure Backup 疎通確認</a><br><a href="#3">3. プライベート エンドポイント環境における Azure Backup 疎通確認</a></p><hr><h2 id="1-Windows-VM-における-Azure-Backup-疎通確認"><a href="#1-Windows-VM-における-Azure-Backup-疎通確認" class="headerlink" title="1. Windows VM における Azure Backup 疎通確認"></a>1. Windows VM における Azure Backup 疎通確認<a id="1"></a></h2><p>まず、下記 リンク先から疎通確認スクリプトのダウンロードをお願いします。<br><a href="https://github.com/jpabrs-scem/blog/files/9391344/Check_Backup_NW_ver1.6.zip">Check_Backup_NW_ver1.6.zip</a></p><p>(スクリプト実行手順)</p><ol><li>疎通確認スクリプトをダウンロードし、展開してください。<br>※ ファイルの解凍パスワードは <strong>“AzureBackup”</strong> となります。</li><li>PowerShell を右クリックし、管理者として実行をクリックしてください。</li></ol><p> <img src="https://user-images.githubusercontent.com/71251920/175529513-5196c393-be7b-439e-aba3-063969d1ce26.png"></p><ol start="3"><li>PowerShell にて手順 1 で展開したスクリプトの場所に移動してください。<br>例 ) “Takato” というユーザーのデスクトップ上の PowerShell というフォルダ内にスクリプトをダウンロードしたときの移動コマンド<blockquote><p>cd C:\Users\Takato\Desktop\powershell</p></blockquote></li><li>以下コマンドを実行し、スクリプトを実行してください。<br>(現在画像とバージョンが異なりますが、同様の手順でございます。)<blockquote><p>.\Check_Backup_NW_ver1.4.ps1<br><img src="https://user-images.githubusercontent.com/71251920/175529518-afd3ab91-e450-42b9-b7b6-310c6633cca1.png"></p></blockquote></li></ol><ul><li>上記スクリプト実施時に実行ポリシーの制限によりスクリプトが実行できない場合はPowerShell を管理者権限で起動し、下記コマンドを実行し実行ポリシーを変更後、再度実行していただければ幸いでございます。<blockquote><p>Set-ExecutionPolicy Unrestricted</p></blockquote></li></ul><ol start="5"><li>以下のような “ScriptStart Completed” 出力がされるまで、お待ちください。</li></ol><p>*コマンドの実行には、環境によって 20 分ほど要する場合がございます。20 分経っても完了しない場合は、control + c を押下して強制終了してください。</p><p><img src="https://user-images.githubusercontent.com/71251920/175529520-b67e7eab-baef-4036-8c89-64ec9a86e40b.gif"></p><ol start="6"><li>コマンド実行が完了すると、スクリプトと同じフォルダ内に以下のようなログファイルが出力されますので、弊社までご提供お願いいたします。<br>ログファイル名: AzureBackup_Check_NW_yyyymmdd_hhmmss.log</li></ol><p><img src="https://user-images.githubusercontent.com/71251920/175529523-b5004d01-f4cd-4879-9c48-b9de17a8c477.jpg"></p><ul><li>control + c にて強制終了した場合においても該当のログファイルが出力されますので、弊社までご提供お願いいたします。</li></ul><h2 id="2-Linux-VM-における-Azure-Backup-疎通確認"><a href="#2-Linux-VM-における-Azure-Backup-疎通確認" class="headerlink" title="2. Linux VM における Azure Backup 疎通確認"></a>2. Linux VM における Azure Backup 疎通確認<a id="2"></a></h2><p>まず、下記 リンク先から疎通確認スクリプトのダウンロードをお願いします。<br><a href="https://github.com/jpabrs-scem/blog/files/9387864/Check_Backup_NW_Linux_ver1.3.zip">Check_Backup_NW_Linux_ver1.3.zip</a></p><p>(スクリプト実行手順)</p><ol><li><p>疎通確認スクリプトをダウンロードし、展開してください。<br>※ ファイルの解凍パスワードは <strong>“AzureBackup”</strong> となります。</p></li><li><p>対象の Linux マシンにスクリプトを移動し実行します。<br>必要に応じて chmod コマンドなどを用いてパーミッションを変更してください。</p><blockquote><p>chmod 777 Check_Backup_NW_Linux_ver1.3.sh </p></blockquote></li></ol><p>下記のように実行します。</p><blockquote><p>./Check_Backup_NW_Linux_ver1.3.sh</p></blockquote><ol start="3"><li>実行完了<br>実行が完了すれば下記のファイルが作成されます。<br>弊社までご提供お願いいたします。<blockquote><p>ログファイルは CheckNWResult_(ホスト名)_(YYYYMMDDHHMM).log です。</p></blockquote></li></ol><h3 id="2-1-参考画像"><a href="#2-1-参考画像" class="headerlink" title="2.1 参考画像"></a>2.1 参考画像</h3><p><img src="https://user-images.githubusercontent.com/71251920/185762249-d5dbed3c-9bce-409e-8a88-a5b43a52fe95.png" alt="-参考画像-"></p><h2 id="3-プライベート-エンドポイント環境における-Azure-Backup-疎通確認"><a href="#3-プライベート-エンドポイント環境における-Azure-Backup-疎通確認" class="headerlink" title="3. プライベート エンドポイント環境における Azure Backup 疎通確認"></a>3. プライベート エンドポイント環境における Azure Backup 疎通確認<a id="3"></a></h2><p> Azure VM 上の DB のバックアップ (Azure  SQL VM Backup や　Azure SAP HANA バックアップ) や MARS エージェントを利用したバックアップで<strong>プライベート エンドポイントをご利用の場合</strong>は下記もご対応お願いします。</p><p>・必須の DNS エントリを取得する<br><a href="https://learn.microsoft.com/ja-jp/azure/backup/private-endpoints#step-1-get-required-dns-entries">https://learn.microsoft.com/ja-jp/azure/backup/private-endpoints#step-1-get-required-dns-entries</a></p><p>上記 URL に従って下記  PowerShell スクリプトをご実施いただき、名前解決ができるかおよび疎通確認をお願いします。</p><p><a href="https://download.microsoft.com/download/1/2/6/126a410b-0e06-45ed-b2df-84f353034fa1/PrivateIP.ps1">PrivateIP.ps1</a></p><p>*Azure PowerShell が実行できる (Az moduleがインストールされた) 環境でご実施ください。</p><p>・[ご参考] Install the Azure Az PowerShell module<br><a href="https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-8.3.0">https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-8.3.0</a></p><h3 id="結果に-“backup”-が含まれる場合から1つの宛先に対する疎通確認"><a href="#結果に-“backup”-が含まれる場合から1つの宛先に対する疎通確認" class="headerlink" title="結果に “backup” が含まれる場合から1つの宛先に対する疎通確認"></a>結果に “backup” が含まれる場合から1つの宛先に対する疎通確認</h3><p>“privatlink” 付の FQDN に対して疎通確認を行ってください。<br>実施いただいたスクリプトの実行結果と後述の疎通確認コマンドの結果をテキスト(可能であれば画面ショットも添えて) zip などにおまとめの上ご提供お願いします。</p><blockquote><p>スクリプト実行結果例)<br><code> </code> &lt;vaultId&gt;-ab-pod01-fc1      <strong>privatelink</strong>.eus.<strong>backup</strong>.windowsazure.com     10.12.0.15</p></blockquote><p>スクリプトの実行結果が上記の場合は下記のようにお願いします。<br>また hosts ファイルをご利用の場合は nslookup コマンドの代わりに ping コマンドをご利用ください。</p><p><strong>windows(PowerShell)</strong></p><blockquote><p>nslookup(ping) &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>tnc -port 443 &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>tnc -port 443 10.12.0.15<br>Invoke-WebRequest https://&lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>Invoke-WebRequest <a href="https://10.12.0.15/">https://10.12.0.15</a></p></blockquote><p><strong>Linux</strong></p><blockquote><p>nslookup(ping) &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>nc -vz &lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>nc -vz  10.12.0.15　443<br>curl -I https://&lt;vaultId&gt;-ab-pod01-fc1.<strong>privatelink</strong>.eus.backup.windowsazure.com<br>curl -I <a href="https://10.12.0.15/">https://10.12.0.15</a> </p></blockquote><h3 id="結果に-“backup”-が含まれない-“blob”-や”queue”等が含まれる-場合"><a href="#結果に-“backup”-が含まれない-“blob”-や”queue”等が含まれる-場合" class="headerlink" title="結果に “backup” が含まれない (“blob” や”queue”等が含まれる) 場合"></a>結果に “backup” が含まれない (“blob” や”queue”等が含まれる) 場合</h3><p>こちらは初期調査では一旦不要です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回は Azure Backup のバックアップ失敗、リストア失敗の時の調査をするにあたり、NW 観点で提供いただきたい情報をお伝えいたします。&lt;br&gt;NW</summary>
      
    
    
    
    
    <category term="Recovery Services vaults" scheme="https://jpabrs-scem.github.io/blog/tags/Recovery-Services-vaults/"/>
    
    <category term="情報採取" scheme="https://jpabrs-scem.github.io/blog/tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/"/>
    
  </entry>
  
  <entry>
    <title>Azure Backup の障害調査に必要な情報</title>
    <link href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigating/"/>
    <id>https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigating/</id>
    <published>2022-02-11T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは。Azure Backup サポートの山本です。<br>今回は Azure Backup のバックアップ失敗、リストア失敗の時の調査をするにあたり、提供いただきたい情報をお伝えいたします。<br>なお、 Azure Backup の障害調査にあたり NW 観点で取得いただきたいログに関しては下記をご覧ください<br>・Azure Backup の障害調査に必要な情報 (疎通確認)<br><a href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigatingNW/">https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/RequestForInvestigatingNW/</a></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><hr><p><a href="#1">1. Azure VM バックアップの障害調査に必要なログ</a><br>  <a href="#1-1">  1-1. Azure VM Backup の VSS 障害調査に追加で必要なログ</a><br><a href="#2">2.   Azure VM バックアップ の ファイルレベル リストア (ILRリストア) 失敗調査に必要なログ</a><br><a href="#3">3. Azure Backup for SAP HANA in Azure VM の障害調査に必要なログ</a><br><a href="#4">4. MARS Backup エージェントを利用したバックアップ の障害調査に必要なログ</a><br>  <a href="#4-1">4-1. Microsoft Azure Backup Agent のログ</a><br>  <a href="#4-2">4-2. システム情報</a><br>  <a href="#4-3">4-3. イベント ログ</a><br>  <a href="#4-4">4.4 各種証明書の確認証跡およびインポート</a></p><hr><h2 id="1-Azure-VM-バックアップの障害調査に必要なログ"><a href="#1-Azure-VM-バックアップの障害調査に必要なログ" class="headerlink" title="1. Azure VM バックアップの障害調査に必要なログ"></a>1. Azure VM バックアップの障害調査に必要なログ<a id="1"></a></h2><p>　*Azure VM Backup ではないですが  Azure Backup for SQL Server in Azure VM や Azure Backup for SAP HANA in Azure VM など Azure VM 上の DB のバックアップに関するものでも同様に必要です。<br>下記の <strong>環境情報</strong>と<strong>ログ情報</strong>の収集をお願いいたします。</p><p>*NVA などの場合、OS が対応していない可能性もございます。<br>(参考) 詳細は下記をご覧ください<br>・NVA のバックアップについて<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/NVA_backup/">https://jpabrs-scem.github.io/blog/AzureVMBackup/NVA_backup/</a></p><h3 id="環境情報"><a href="#環境情報" class="headerlink" title="環境情報"></a>環境情報</h3><p>・Subscription ID<br>・Recovery Services コンテナー名、およびそのリソースグループ名<br>・バックアップ対象 VM 名、およびそのリソースグループ名<br>・OS およびバージョン情報</p><h4 id="ログ情報"><a href="#ログ情報" class="headerlink" title="ログ情報"></a>ログ情報</h4><p>下記を参考に zip などにまとめてご提供いただけますと幸いです。</p><h4 id="・Windows-の場合"><a href="#・Windows-の場合" class="headerlink" title="・Windows の場合"></a>・Windows の場合</h4><blockquote><p>C:\Windows\System32\winevt\Logs<br>C:\WindowsAzure\</p></blockquote><h4 id="・Linuxの場合"><a href="#・Linuxの場合" class="headerlink" title="・Linuxの場合"></a>・Linuxの場合</h4><blockquote><p>/var/log/</p></blockquote><p>全量いただけることが望ましいですが、全量が困難な場合は下記をご提供ください。</p><blockquote><p>/var/log/azure/*<br>/var/log/syslog*<br>/var/log/waagent.*</p></blockquote><h3 id="1-1-Azure-VM-Backup-の-VSS-障害調査に追加で必要なログ"><a href="#1-1-Azure-VM-Backup-の-VSS-障害調査に追加で必要なログ" class="headerlink" title="1-1 . Azure VM Backup の VSS 障害調査に追加で必要なログ"></a>1-1 . Azure VM Backup の VSS 障害調査に追加で必要なログ<a id="1-1"></a></h3><p>Azure VM Backupの下記のようなエラーが出ることがございます。<br>その場合には VSS 観点での調査が必要であるため、そのため上記 <a href="#1">1. Azure VM バックアップの障害調査に必要なログ</a> に加えて下記のログの採取もお願いします。</p><blockquote><p>Error Code ：Snapshot operation failed due to VSS Writers in bad state.<br>Error Message ：ExtensionFailedVssWriterInBadState</p></blockquote><p>VSS 観点での調査のためには下記 URL 先のログの採取をお願いします。<br> <strong>可能な限り “[A]”が望ましいですが、”[B]” の方法で採取いただいても、ある程度は調査が可能な場合がございます。</strong><br>・VSS エラーが発生している事象の調査<br><a href="https://jpwinsup.github.io/mslog/storage/vss/vss-error.html">https://jpwinsup.github.io/mslog/storage/vss/vss-error.html</a></p><p>また合わせて下記も関連するブログでございます。<br>・Azure VM Backupにおける整合性について<br><a href="https://jpabrs-scem.github.io/blog/AzureVMBackup/Consistencies/#1-1-VSS-%E8%A6%B3%E7%82%B9%E3%81%A7%E3%81%AE%E8%AA%BF%E6%9F%BB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">https://jpabrs-scem.github.io/blog/AzureVMBackup/Consistencies/#1-1-VSS-%E8%A6%B3%E7%82%B9%E3%81%A7%E3%81%AE%E8%AA%BF%E6%9F%BB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6</a></p><h2 id="2-Azure-VM-バックアップ-の-ファイルレベル-リストア-ILRリストア-失敗調査に必要なログ"><a href="#2-Azure-VM-バックアップ-の-ファイルレベル-リストア-ILRリストア-失敗調査に必要なログ" class="headerlink" title="2.   Azure VM バックアップ の ファイルレベル リストア (ILRリストア) 失敗調査に必要なログ"></a>2.   Azure VM バックアップ の ファイルレベル リストア (ILRリストア) 失敗調査に必要なログ<a id="2"></a></h2><p>下記の <strong>環境情報</strong>と<strong>ログ情報</strong>の収集をお願いいたします。</p><h3 id="環境情報-1"><a href="#環境情報-1" class="headerlink" title="環境情報"></a>環境情報</h3><p>・Subscription ID<br>・Recovery Services コンテナー名、およびそのリソースグループ名<br>・バックアップ対象 VM 名、およびそのリソースグループ名、OS 名<br>・リストア先の VM 名、およびそのリソースグループ名、OS 名</p><h3 id="ログ情報-1"><a href="#ログ情報-1" class="headerlink" title="ログ情報"></a>ログ情報</h3><p>zip などにまとめてご提供いただけますと幸いです。</p><h4 id="・-Windows-の場合-“ディスクの管理”-の画面の画面ショット"><a href="#・-Windows-の場合-“ディスクの管理”-の画面の画面ショット" class="headerlink" title="・(Windows の場合) “ディスクの管理” の画面の画面ショット"></a>・(Windows の場合) “ディスクの管理” の画面の画面ショット</h4><p><img src="https://user-images.githubusercontent.com/71251920/153464381-6ba8f9bf-56fd-48fd-9784-b819d8a4f79c.png" alt="参考画像"></p><h4 id="・実行したスクリプト、および実行後に作成されたフォルダ一式"><a href="#・実行したスクリプト、および実行後に作成されたフォルダ一式" class="headerlink" title="・実行したスクリプト、および実行後に作成されたフォルダ一式"></a>・実行したスクリプト、および実行後に作成されたフォルダ一式</h4><ul><li><strong>Windowsの場合</strong><br>・スクリプトファイル：IaaSVMILRExeForWindows.exe<br>・スクリプト実行後に作成されるフォルダー：”仮想マシン名(小文字)”+”スクリプトファイル実行日時”</li></ul><p>　下記例では “okt-temp-win-20220212145642” が作成されています。<br><img src="https://user-images.githubusercontent.com/71251920/153714819-e9f24f63-75f0-4268-b0fc-ac6e43155cc1.png"></p><p>“okt-temp-win-20220212145642”の中身<br><img src="https://user-images.githubusercontent.com/71251920/153714818-906282be-7acc-4e9f-9d4e-62d5b2b369a0.png" alt="&quot;okt-temp-win-20220212145642&quot;の中身"></p><ul><li><strong>Linux の場合</strong><br>・ILRのスクリプトファイル：例)　<strong>vm02kensho(小文字VM名)_1_jpe_6591639015130036692_802427195716_899298aac7c04bf094ad68bfc5b9584ed206b94b62d965.py</strong><br>・作成されたディレクトリの <strong>Scripts ディレクトリ一式</strong>：例） <strong>vm02kensho-20220212151619/Script</strong><br>スクリプトを実行後、「<strong>vm02kensho-20220212151619</strong>」ディレクトリが自動生成されていることがわかる。<br><img src="https://user-images.githubusercontent.com/71251920/153714817-892202e9-3df5-4377-9276-42b16eb82fd4.png"></li></ul><blockquote><p>ls -all</p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/153714816-49b0446b-8728-498e-b51f-bff02f37f0a5.png" alt="「vm02kensho-20220212151619」ディレクトリが自動生成されている"></p><p>「vm02kensho-20220212151619」ディレクトリの中身、および作成されたディレクトリの <strong>Scripts ディレクトリ</strong>の中身は下記の通り</p><blockquote><p>ls -allR</p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/153714814-a652e630-b1c8-4e43-a96f-4d974c9d7cf4.png" alt="「vm02kensho-20220212151619」ディレクトリの中身,および作成されたディレクトリの Scripts ディレクトリの中身"></p><h2 id="3-Azure-Backup-for-SAP-HANA-in-Azure-VM-の障害調査に必要なログ"><a href="#3-Azure-Backup-for-SAP-HANA-in-Azure-VM-の障害調査に必要なログ" class="headerlink" title="3. Azure Backup for SAP HANA in Azure VM の障害調査に必要なログ"></a>3. Azure Backup for SAP HANA in Azure VM の障害調査に必要なログ<a id="3"></a></h2><p> <a href="#1">1. Azure VM バックアップの障害調査に必要なログ</a> の <strong>環境情報</strong> ならびに <strong>ログ情報 - Linuxの場合</strong> に加えて下記もご対応お願いします。<br>*お手数ですが、全ての DB の backup.log 及び backint.log の採取をお願いします。</p><h3 id="SAP-HANAのbackup-log-及び-backint-log"><a href="#SAP-HANAのbackup-log-及び-backint-log" class="headerlink" title="SAP HANAのbackup.log 及び backint.log"></a>SAP HANAのbackup.log 及び backint.log</h3><blockquote><ul><li>xxにはインスタンスナンバーが入ります。<br>  ・/hana/shared/HXE/HDBxx/<hostname>/trace/backup.log<br>  ・/hana/shared/HXE/HDBxx/<hostname>/trace/DB_&lt;DB名&gt;/backup.log<br>  ・/hana/shared/HXE/HDBxx/<hostname>/trace/backint.log<br>  ・/hana/shared/HXE/HDBxx/<hostname>/trace/DB_&lt;DB名&gt;/backint.log</li></ul></blockquote><p>*上記パスに該当のログが無い場合は以下を試し、コマンド実行結果に表示されディレクトリの場所の log をアップロードしてください。</p><blockquote><p>   #sudo -i (rootユーザーに切り替えます)<br>    #cd / (ディレクトリの最上層に移動します)<br>    #find ./ -name “backup.log” (findコマンドにより該当のログの場所を特定します)<br>    #find ./ -name “backint.log” (findコマンドにより該当のログの場所を特定します)</p></blockquote><h2 id="4-MARS-Backup-エージェントを利用したバックアップ-の障害調査に必要なログ"><a href="#4-MARS-Backup-エージェントを利用したバックアップ-の障害調査に必要なログ" class="headerlink" title="4. MARS Backup エージェントを利用したバックアップ の障害調査に必要なログ"></a>4. MARS Backup エージェントを利用したバックアップ の障害調査に必要なログ<a id="4"></a></h2><h2 id="4-0-環境情報とWindowsログ"><a href="#4-0-環境情報とWindowsログ" class="headerlink" title="4.0 環境情報とWindowsログ"></a>4.0 環境情報とWindowsログ</h2><p><a href="#1">1. Azure VM バックアップの障害調査に必要なログ</a> の <strong>環境情報</strong> ならびに <strong>ログ情報 - Windows の場合</strong> の取得をお願いします。<br>*MARS バックアップ のバックアップ対象の環境が Azure VM でない場合は Azure VM 名 / VM リソース グループ名は不要です。</p><p>上記に加えて下記もご対応お願いします。</p><h3 id="4-1-Microsoft-Azure-Backup-Agent-のログ"><a href="#4-1-Microsoft-Azure-Backup-Agent-のログ" class="headerlink" title="4.1 Microsoft Azure Backup Agent のログ　"></a>4.1 Microsoft Azure Backup Agent のログ　<a id="4-1"></a></h3><p> まず、下記 リンク先から調査用スクリプトのダウンロードをお願いします。<br><a href="https://github.com/jpabrs-scem/blog/files/8045897/WABDiag.zip">WABDiag.zip</a></p><p>ダウンロードいただきました WABDiag.tx を .ps1 に変更して使用し、問題が発生しているマシンより Azure Backup ログの収集をお願いいたします。<br>※ ファイルの解凍パスワードは “AzureBackup” となります。</p><ol><li>WABDiag.ps1 を管理者権限の PowerShell で実行します。</li></ol><blockquote><p>実行コマンド: &lt;スクリプトのパス&gt;\WABDiag.ps1 &lt;パス\保存するフォルダ名&gt;<br>   実行例: C:\WABDiag\WABDiag.ps1 C:\Logs</p></blockquote><p>   実行結果にファイル パスが無い旨のメッセージが表示される可能性がございますが、対象のファイル自体が無い事を示すメッセージとなりますので、無視していただいて問題ございません。</p><h4 id="PowerShell-の実行ポリシーの制限によりスクリプトが実行できない場合"><a href="#PowerShell-の実行ポリシーの制限によりスクリプトが実行できない場合" class="headerlink" title="PowerShell の実行ポリシーの制限によりスクリプトが実行できない場合"></a>PowerShell の実行ポリシーの制限によりスクリプトが実行できない場合</h4><p>PowerShellを管理者権限で起動し、下記コマンドを実行し実行ポリシーを変更後、再度実行していただけますでしょうか。</p><blockquote><p>コマンド：Set-ExecutionPolicy Unrestricted</p></blockquote><p>また現在の実行ポリシーを後ほど元に戻す場合は、変更前に下記コマンドを実行し、設定されているポリシーを確認、メモし、スクリプト実行後に同様の手順で変更していただきますようお願いいたします。</p><blockquote><p>コマンド：Get-ExecutionPolicy </p></blockquote><ul><li>参考<br>・実行ポリシーについて - PowerShell<br><a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2">https://docs.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2</a></li></ul><h3 id="4-2-システム情報"><a href="#4-2-システム情報" class="headerlink" title="4.2 システム情報 "></a>4.2 システム情報 <a id="4-2"></a></h3><ol><li>対象のマシンに管理者権限を保持するユーザーでログオンします。</li><li>管理者権限でコマンド プロンプトを起動し、以下のコマンドで取得します。<blockquote><p>msinfo32 /nfo &lt;出力ファイル名&gt;<br>実行例)  &gt; msinfo32 /nfo SVR_msinfo32.nfo</p></blockquote></li><li>生成されたファイルをご提供ください。</li></ol><h3 id="4-3-イベント-ログ"><a href="#4-3-イベント-ログ" class="headerlink" title="4.3 イベント ログ"></a>4.3 イベント ログ<a id="4-3"></a></h3><ol><li>対象のマシンに管理者権限を保持するユーザーでログオンします。</li><li>[スタート] - [管理ツール] - [イベント ビューアー] を開きます。</li><li>左側ペインの以下のイベントに対して、右クリックをし、[すべてのイベントを名前をつけて保存] を選択し、ファイルの種類が “イベント ファイル (<em>.evtx)” であることを確認し、任意の名前を付けて、[保存] をクリックします。<br>(ファイルの種類が “イベント ファイル (</em>.csv)” も併せて取得をお願いいたします)<br>a) [イベント ビューアー (ローカル)] - [Windows ログ] - [システム]<br>b) [イベント ビューアー (ローカル)] - [Windows ログ] - [Application]</li><li>保存したイベント ログ ファイルをご提供ください。</li></ol><h3 id="4-4-各種証明書の確認証跡およびインポート"><a href="#4-4-各種証明書の確認証跡およびインポート" class="headerlink" title="4.4 各種証明書の確認証跡およびインポート"></a>4.4 各種証明書の確認証跡およびインポート<a id="4-4"></a></h3><p>下記詳細手順のもと、証明書 および 権限の確認を確認のうえ、画面ショットを zip などにおまとめの上ご提供お願いいたします。</p><p>*該当の証明書がない場合は下記 URL よりダウンロードしインポートをお願いします。<br>これによりMARS エージェントが立ち上がらないなどの場合の場合改善することがございます。</p><p>対象マシン上の「スタート」ボタンを右クリック＞「ファイル名を指定して実行」＞「certlm.msc」と入力して「OK」し、以下すべての証明書が存在するかご確認ください。<br><strong>（※ Windows Server 2012 以前の OS の場合は、MMC スナップインより証明書スナップインを起動してください）</strong></p><p><img src="https://user-images.githubusercontent.com/71251920/182520764-1ed4e4ab-c925-4a87-b905-1414bab17e47.png"></p><p><img src="https://user-images.githubusercontent.com/71251920/182520768-feacd580-7217-4148-af08-27cab663d93f.png"></p><h4 id="個人-＞-証明書"><a href="#個人-＞-証明書" class="headerlink" title="個人 ＞ 証明書"></a>個人 ＞ 証明書</h4><blockquote><p>・CB_&lt;MARSのバックアップを実施する予定のRecovery Services コンテナー名 → -x-x-xxxx-vaultcredentials<br>・CB_&lt;ホスト名&gt;._xxxxxxxxxxxxxxxxxx<br>※　上記 2 が存在していることを確認の上、その画面スクリーンショットをご提供ください<br>（存在していない場合もございますので、その場合は、その点ご返信いただけますと幸いです。）<br><img src="https://user-images.githubusercontent.com/71251920/182520770-6e2bac01-d72e-4a3a-b358-56f853538f5a.png"></p></blockquote><p>“<strong>・CB_&lt;ホスト名&gt;._xxxxxxxxxxxxxxxxxx</strong> の期限がきれている場合は正常に MARS エージェントが正常に起動しないことがあります。<br>下記を参考に再インストール をご実施ください。それにより証明書がインストールされます。<br>・MARS エージェントの再インストール手順<br><a href="https://jpabrs-scem.github.io/blog/MARSBackup/How_to_re-install/">https://jpabrs-scem.github.io/blog/MARSBackup/How_to_re-install/</a></p><h4 id="信頼されたルート証明書-＞-証明書"><a href="#信頼されたルート証明書-＞-証明書" class="headerlink" title="信頼されたルート証明書 ＞ 証明書"></a>信頼されたルート証明書 ＞ 証明書</h4><p>[参考]<br>・Azure TLS 証明書の変更<br><a href="https://learn.microsoft.com/ja-jp/azure/security/fundamentals/tls-certificate-changes#what-changed">https://learn.microsoft.com/ja-jp/azure/security/fundamentals/tls-certificate-changes#what-changed</a></p><p>[証明書zipダウンロード先]<br><a href="https://github.com/jpabrs-scem/blog/files/9615338/root.certificate.zip">root certificate.zip</a></p><blockquote><p>ルート証明書名    証明書の拇印<br><a href="https://cacerts.digicert.com/DigiCertGlobalRootG2.crt">DigiCert Global Root G2    : df3c24f9bfd666761b268073fe06d1cc8d4f82a4</a><br><a href="https://cacerts.digicert.com/DigiCertGlobalRootCA.crt">DigiCert Global Root CA    : a8985d3a65e5e5c4b2d7d66d40c6dd2fb19c5436</a><br><a href="https://cacerts.digicert.com/BaltimoreCyberTrustRoot.crt">Baltimore CyberTrust Root    : d4de20d05e66fc53fe1a50882c78db2852cae474</a><br><a href="https://www.d-trust.net/cgi-bin/D-TRUST_Root_Class_3_CA_2_2009.crt">D-TRUST Root Class 3 CA 2 2009    : 58e8abb0361533fb80f79b1b6d29d3ff8d5f00f0</a><br><a href="https://www.microsoft.com/pkiops/certs/Microsoft%20RSA%20Root%20Certificate%20Authority%202017.crt">Microsoft RSA Root Certificate Authority2017    : 73a5e64a3bff8316ff0edccc618a906e4eae4d74</a><br><a href="https://www.microsoft.com/pkiops/certs/Microsoft%20ECC%20Root%20Certificate%20Authority%202017.crt">Microsoft ECC Root Certificate Authority 2017    : 999a64c37ff47d9fab95f14769891460eec4c3c5</a></p></blockquote><p><img src="https://user-images.githubusercontent.com/71251920/182520772-59ba76df-31cf-488d-bfec-066830b44698.png"></p><p>※　上記 6 つすべての証明書が存在していること (存在していない場合もございます)<br>・証明書をダブルクリックし、「詳細」タブ ＞ スクロールして下の方に「拇印」がありますので、値が上記と同一であることが確認し、その画面ショットをご提供ください。<br>（存在していない場合もございますので、その場合は、その点ご返信いただけますと幸いです。）</p><p><img src="https://user-images.githubusercontent.com/71251920/182520776-8f30a8f5-67d5-4bfd-a264-590ca251689d.png"></p><h4 id="中間証明機関-＞-証明書"><a href="#中間証明機関-＞-証明書" class="headerlink" title="中間証明機関 ＞ 証明書"></a>中間証明機関 ＞ 証明書</h4><p>[参考]<br>・Azure Storage TLS: Changes are coming! (…and why you care)<br><a href="https://learn.microsoft.com/ja-jp/azure/security/fundamentals/tls-certificate-changes#what-changed">https://learn.microsoft.com/ja-jp/azure/security/fundamentals/tls-certificate-changes#what-changed</a></p><p>[証明書zipダウンロード先]<br><a href="https://github.com/jpabrs-scem/blog/files/9615291/intermediate.certificate.zip">intermediate certificate.zip</a></p><blockquote><p>中間証明書名    証明書の拇印<br><a href="http://www.microsoft.com/pki/mscorp/Microsoft%20RSA%20TLS%20CA%2001.crt">Microsoft RSA TLS CA 01    : 703d7a8f0ebf55aaa59f98eaf4a206004eb2516a</a><br><a href="http://www.microsoft.com/pki/mscorp/Microsoft%20RSA%20TLS%20CA%2002.crt">Microsoft RSA TLS CA 02    : b0c2d2d13cdd56cdaa6ab6e2c04440be4a429c75</a></p></blockquote><p>※　上記 2 つすべての証明書が存在していること<br>・証明書をダブルクリックし、「詳細」タブ ＞ スクロールして下の方に「拇印」がありますので、値が上記と同一であることが確認できる画面スクリーンショットをご提供ください。</p><p><img src="https://user-images.githubusercontent.com/71251920/182520778-a9e6e160-5830-4cf5-a6c3-00acf7ce0941.png"></p><h4 id="証明書インポート手順"><a href="#証明書インポート手順" class="headerlink" title="証明書インポート手順"></a>証明書インポート手順</h4><ol><li>証明書をエクスポートしたいマシンに、管理者権限でログインします。</li><li>[スタート] - [ファイル名を指定して実行] から、certlm.msc と入力して、[Enter]キーを押します。<strong>（※ Windows Server 2012 以前の OS の場合は、MMC スナップインより証明書スナップインを起動してください）</strong></li><li>ユーザーアカウント制御 が起動する場合は管理者権限での実行を許可します。</li><li>左側の [証明書 (ローカル コンピューター)]を展開して、 [信頼されたルート証明機関] - [証明書] を開きます。</li><li>[証明書] を右クリックし [すべてのタスク] – [インポート] と選択します。</li><li>証明書のインポートウィザードが起動しますので以下の様に進めます。<br>・ 「証明書のインポート ウィザードの開始」画面で [次へ] をクリック。<br>・ インポートする証明書のファイル  -&gt;  (上記公開情報よりダウンロードした各証明書を保存したパス)<br>・ 証明書ストア -&gt; (“信頼されたルート証明機関” となっていることを確認)</li><li>「信頼されたルート証明機関」証明書ストアに証明書がインポートされた事を確認します。</li></ol><ul><li>中間証明書のインポート手順は、上記の「信頼されたルート証明機関」の箇所を「中間証明機関」にお読み替えいただけますようお願いいたします。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは。Azure Backup サポートの山本です。&lt;br&gt;今回は Azure Backup のバックアップ失敗、リストア失敗の時の調査をするにあたり、提供いただきたい情報をお伝えいたします。&lt;br&gt;なお、 Azur</summary>
      
    
    
    
    
    <category term="Recovery Services vaults" scheme="https://jpabrs-scem.github.io/blog/tags/Recovery-Services-vaults/"/>
    
    <category term="情報採取" scheme="https://jpabrs-scem.github.io/blog/tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/"/>
    
  </entry>
  
  <entry>
    <title>「Azure Monitor を使用した組み込みのアラート」を利用したバックアップ ジョブ失敗のアラート通知作成例</title>
    <link href="https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/How_to_set_Backup_Alert/"/>
    <id>https://jpabrs-scem.github.io/blog/RecoveryServicesVaults/How_to_set_Backup_Alert/</id>
    <published>2022-01-24T03:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.722Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、Azure Backup サポートです。<br>今回は、<strong>「Azure Monitor を使用した組み込みのアラート」を利用して、Recovery Services コンテナーにてバックアップ構成済のバックアップ ジョブが失敗した際にメール通知を出すよう、アラート処理ルールを作成する例</strong> をご紹介します。</p><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>・「Azure Monitor を使用した組み込みのアラート」を利用<br>・アラート処理ルールには、バックアップを構成している対象のRecovery Services コンテナーをスコープとして指定し、バックアップ ジョブが失敗した際に、指定のメールアドレスへ通知メールを送信させる</p><h2 id="アラート処理ルール-作成手順"><a href="#アラート処理ルール-作成手順" class="headerlink" title="アラート処理ルール 作成手順"></a>アラート処理ルール 作成手順</h2><p>Azure Backup にて、バックアップ ジョブが失敗した際にアラート通知を出す手段は、下記ドキュメントの通り複数種類ございます。<br>今回は <strong>「Azure Monitor を使用した組み込みのアラート」</strong> を利用します。<br>・Azure Backup の監視とレポートのソリューション<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/monitoring-and-alerts-overview#monitoring-and-reporting-scenarios">https://docs.microsoft.com/ja-jp/azure/backup/monitoring-and-alerts-overview#monitoring-and-reporting-scenarios</a></p><p><img src="https://user-images.githubusercontent.com/71251920/151009982-ca6af556-0142-42f7-b991-33de2714c482.png" alt="How_to_set_Backup_Alert_01"></p><p>「Azure Monitor を使用した組み込みのアラート」を利用した、アラート ルールの作成手順の公開ドキュメントは下記にございます。<br>・ジョブの失敗のシナリオに対して Azure Monitor のアラートを有効にする<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor#turning-on-azure-monitor-alerts-for-job-failure-scenarios">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor#turning-on-azure-monitor-alerts-for-job-failure-scenarios</a></p><p><img src="https://user-images.githubusercontent.com/71251920/151009985-41e50961-1328-4ca2-9814-116dd8eb63cf.png" alt="How_to_set_Backup_Alert_02"></p><p>・アラートの通知を構成する<br><a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor#configuring-notifications-for-alerts">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor#configuring-notifications-for-alerts</a></p><p>バックアップ センター ＞ アラート処理ルール にて、新しいアラート処理ルールを作成することができます。</p><p><img src="https://user-images.githubusercontent.com/71251920/151009987-c76bcfcd-04f3-49f4-ae05-033d3eee4d4e.png" alt="How_to_set_Backup_Alert_03"></p><p><img src="https://user-images.githubusercontent.com/71251920/151009990-288bd354-12f3-4a43-a567-3bb4b5ea9cab.png" alt="How_to_set_Backup_Alert_04"></p><p>今回は、Recovery Services コンテナー「RSV-JPE-LRS」にて Azure Files をバックアップ構成しているため、スコープを「Recovery Services コンテナー：RSV-JPE-LRS」としています。</p><p><img src="https://user-images.githubusercontent.com/71251920/151009992-071f529c-b069-4e95-b579-57e41d858db5.png" alt="How_to_set_Backup_Alert_05"></p><p>また、バックアップ ジョブのエラーを検知した際にアラート通知を発報したいため、「フィルター：重要度」とし、「階層：１ - エラー」を選択します。<br>・Azure Backup で保護されたワークロードの監視<br>　<a href="https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor#azure-monitor-alerts-for-azure-backup-preview">https://docs.microsoft.com/ja-jp/azure/backup/backup-azure-monitoring-built-in-monitor#azure-monitor-alerts-for-azure-backup-preview</a></p><p><img src="https://user-images.githubusercontent.com/71251920/151009994-805f0f47-4085-4c6b-b1e0-5453f242f62f.png" alt="How_to_set_Backup_Alert_06"></p><p><img src="https://user-images.githubusercontent.com/71251920/151009996-9dc217c3-e7ed-43dd-b777-a7f82bf9081b.png" alt="How_to_set_Backup_Alert_07"></p><p><img src="https://user-images.githubusercontent.com/71251920/151009999-50e00252-c95e-47df-b6c9-60fb7255e24a.png" alt="How_to_set_Backup_Alert_08"></p><p>「アクション グループ」には、送信したいメールアドレスを設定しているアクション グループを追加する、もしくは新規作成します。<br>今回はあらかじめ作成済のアクション グループを選択しています。</p><p><img src="https://user-images.githubusercontent.com/71251920/151010003-78799d24-3c6a-4ff6-a8ff-39c7c7c95e90.png" alt="How_to_set_Backup_Alert_09"></p><p> （補足）アクショングループには、下図のように電子メールへの通知を設定済となっています</p><p><img src="https://user-images.githubusercontent.com/71251920/151010005-e0d96c25-d7cc-4789-9b1e-6be5458b86f6.png" alt="How_to_set_Backup_Alert_10"></p><p><img src="https://user-images.githubusercontent.com/71251920/151010009-0b53d0c3-1d15-4902-9059-ad96f54cb6e6.png" alt="How_to_set_Backup_Alert_11"></p><p><img src="https://user-images.githubusercontent.com/71251920/151010014-e76647b0-3eb5-4cc8-8558-b38636996f48.png" alt="How_to_set_Backup_Alert_12"></p><p>上図のように設定することで、Recovery Services コンテナー「RSV-JPE-LRS」にてバックアップ構成済のバックアップ ジョブが失敗した際に、指定した電子メール宛先へ、通知メールが送信されるようになります。<br><strong>Subscription 全体を指定指定していただくことで Subscription 全体の Recovery Services コンテナーに対するバックアップアラートを設定することもできます。</strong></p><p><img src="https://user-images.githubusercontent.com/71251920/151009979-8f6868a8-2edd-4d08-86a5-ef843a877bda.png" alt="How_to_set_Backup_Alert_13"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、Azure Backup サポートです。&lt;br&gt;今回は、&lt;strong&gt;「Azure Monitor を使用した組み込みのアラート」を利用して、Recovery Services コンテナーにてバックアップ構成</summary>
      
    
    
    
    
    <category term="Recovery Services vaults" scheme="https://jpabrs-scem.github.io/blog/tags/Recovery-Services-vaults/"/>
    
    <category term="how to" scheme="https://jpabrs-scem.github.io/blog/tags/how-to/"/>
    
  </entry>
  
  <entry>
    <title>Example article</title>
    <link href="https://jpabrs-scem.github.io/blog/information/test/"/>
    <id>https://jpabrs-scem.github.io/blog/information/test/</id>
    <published>2020-12-21T06:00:00.000Z</published>
    <updated>2022-10-26T05:44:11.738Z</updated>
    
    <content type="html"><![CDATA[<p>hello, world!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;hello, world!&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="Information" scheme="https://jpabrs-scem.github.io/blog/tags/Information/"/>
    
  </entry>
  
</feed>
